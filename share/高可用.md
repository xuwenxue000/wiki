# 互联网架构之高可用
## 经典定律CAP
- 何为CAP
    - Consistency：一致性,可参考事务隔离级别
        - Read uncommitted(读未提交)
        - Read committed(读已提交)
        - Repeatable read (可重复读)
        - Serializable (串行化)
    - Availiability：可用性
    - Partition Tolerance ：分区容错性
    - 这三个要素最多只能同时实现两点，不可能三者兼顾。因此架构设计必须做出取舍
- 经典组合
    - CA -- 单机单线程,典型案例:单机redis,互联网架构基本是无法用这个组合的,分区容错是必须的,那么就需要在下面的两个组合里选了
    - CP -- 较低一致性的情况下,可以读写分离(读不一致),较高一致性的话可以多写(读一致,但没读写锁),全写成功才算成功,强一致性就只能是分布式事务了(读写锁),
    只要返回成功则数据不可以丢失,一般应用于支付金融等业务高一致性业务
    - AP -- 确保一致性吗?尽量保证最终一致性..允许极限情况下丢失部分数据.尽量不丢.目的是要保证服务的可用性,稳定性,互联网大部分场景用的这个,其中最大的一个因素是流量比较大,
    也就是高并发
## 何为高可用
    999,一年500分钟,非核心业务,异步非实时任务
    9999,一年50分钟,核心业务,实时场景
    99999,一年5分钟,金融,电信类业务
    
## 如何高可用
   代价从小到大
   业务
        分清楚什么时候核心业务,重要程度,几个9.这个代价最小,收益最高
   代码
        限流
            确保服务不会雪崩,至少大部分可用,而不是整个不可用,比如双11,比如秒杀
        熔断
            确保主业务不会被一些次要服务影响,次要服务出现延迟或故障时,自动舍弃,正常后自动恢复
        降级
            当次要服务完全不可用的时候,手动降级,不在访问,恢复之后再使用,一般为手动操作
        兜底
            当主要服务出现问题.那么需要有备用方案,比如备用策略,默认策略,损失部分体验,一般用于读兜底,写业务一般是同步转异步
        
   基础设施
   机器
   机房